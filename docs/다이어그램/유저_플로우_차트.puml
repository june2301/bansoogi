@startuml
title Eggi 앱 유저 플로우 (업데이트)

start
:앱 스토어 접속;
:모바일·워치 앱 다운로드 및 설치;

:앱 실행;
if (첫 실행인가?) then (예)
  :프로필 설정;
  :희망 기상/취침/식사 시간 설정;
endif

:홈 대시보드 진입;

partition Background {
  :활동 & 수면 자동 모니터링 시작;
  :상태 유지 시간 설정 (기본 30분, 10분 단위 조정);
}

fork
  if (사용자 → 미션 탭 열기?) then (예)
    :미션 확인 & 완료;
  endif
fork again
  if (누움 상태 지속 >= 설정 시간?) then (예)
    :“일어나세요!” 알림 (모바일/워치);
    :행동 변화 감지 → 에너지 10점 + “얏호~” 반응;
  endif
fork again
  if (앉음 상태 지속 >= 설정 시간?) then (예)
    :“에기가 눌러 붙고 있어요!” 알림 (모바일/워치);
    :행동 변화 감지 → 에너지 10점 + “얏호~” 반응;
  endif
fork again
  if (폰 사용 상태 지속 >= 설정 시간?) then (예)
    :“에기의 시력이 나빠지고 있어요!” 알림 (모바일/워치);
    :행동 변화 감지 → 에너지 10점 + “얏호~” 반응;
  endif
end fork

if (현재 시각 == 취침 시간?) then (예)
  :결산 타임 알림 전송;
  :데이터 조회 및 점수 계산;
  if (점수 < 80%) then
    :Basic Eggi 생성;
  elseif (점수 < 100%) then
    :Standard Eggi 생성;
  else
    :Golden Eggi 생성;
  endif
  :달력에 Eggi 기록;
  :흰 알 지급;
endif

' — 흰 알 깨기 플로우
if (흰 알 터치?) then (예)
  :흰 알 흔들림 애니메이션;
  repeat
    :터치 → 흔들기;
  repeat while (터치 횟수 < 3)
  :흰 알 파손 → 에기 등장 애니메이션 + “안녕~”;
  :수면 상태 기반 초기 에너지 결정;
endif

' — 캐릭터 상호작용
if (캐릭터 터치?) then (예)
  repeat
    :캐릭터 터치 → 반응 애니메이션 + 에너지 +5;
  repeat while (터치 횟수 < 6)
  :쿨다운 1시간;
endif

' — 컬렉션 보기
if (사용자 → 컬렉션 탭 열기?) then (예)
  :에기 컬렉션 UI 표시;
  if (에기 클릭?) then (예)
    :상세 정보 표시 (이름·획득 횟수·최초 획득일·설명);
  endif
endif

' — 오늘 활동 현황
if (사용자 → 오늘 활동 현황 보기?) then (예)
  :오늘의 활동 요약 표시;
endif

stop
@enduml